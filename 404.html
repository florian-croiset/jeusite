<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>404</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="https://florian-croiset.github.io/jeusite/css/responsive.css">
    <link rel="stylesheet" href="https://florian-croiset.github.io/jeusite/css/main.css">
    <link rel="stylesheet" href="https://florian-croiset.github.io/jeusite/css/couleurs.css">
    <link rel="stylesheet" href="https://florian-croiset.github.io/jeusite/css/layout.css">
    <link rel="stylesheet" href="https://florian-croiset.github.io/jeusite/css/components.css">
    <link rel="stylesheet" href="https://florian-croiset.github.io/jeusite/css/effects.css">
    <link rel="stylesheet" href="https://florian-croiset.github.io/jeusite/css/hero.css">
    <link rel="icon" href="https://florian-croiset.github.io/jeusite/assets/favicon.ico" type="image/x-icon">
</head>
<style>
html, body {
  overflow: hidden!important; /* EmpÃªche tout dÃ©filement */
  height: 100%!important;     /* Assure que la hauteur reste fixe */
  cursor: default!important;
}
</style>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo-container">
                <div class="logo"><a href="#accueil" style="text-decoration:none;">Echo - 404</a></div>
            </div>
            <div class="burger" id="burger">
                <span></span>
                <span></span>
                <span></span>
            </div>
            <ul class="nav-links" id="nav-links">
                <li><a href="https://florian-croiset.github.io/jeusite/" class="btn-login"><i class="fa-solid fa-hand-point-right"></i> Retour au site principal <i class="fa-solid fa-hand-point-left"></i></a></li>
            </ul>
        </div>
    </nav>
    <section class="hero" style="opacity: 1!important;">
        <video autoplay muted loop playsinline class="background-video">
            <source src="https://florian-croiset.github.io/jeusite/assets/mp4compressFlamme.mp4" type="video/mp4">Votre navigateur ne supporte pas la
            lecture vidÃ©o.
        </video>
        <div class="arriere" id="accueil"></div>
        <div class="particles" aria-hidden="true"></div>
        <div class="hero-content">
            <h1 style="opacity: 1;"><span id="dynamicTitle"></span></h1>
            <p class="nav-links" style="gap:inherit!important; place-items: center; margin-left: 135px;"><span
                    style="display: inline-block; text-align: center; margin-right:100px;">par la&nbsp;<a href="https://florian-croiset.github.io/jeusite/index.html#team"
                        style="font-size: 2rem;">Team Nightberry</a></span></p>
            <div class="cta-buttons">
                <a href="https://florian-croiset.github.io/jeusite/" class="btn btn-secondary" rel="noopener noreferrer">Aller au site principal</a>
            </div>
        </div>
    </section>
</body>
<script>
document.body.style.overflow = "hidden";
</script>
<style>
    #dynamicTitle {transition: opacity 0.5s ease;}
    .fade-out {opacity: 0;}
    .fade-in {opacity: 1;}
    .cta-buttons{margin-top:40px;}
    .btn{margin-top: 30px;}
@media (max-width: 768px) {
    .cta-buttons{display:inline-block;margin-top:60px!important;width: 100%;}
    .cta-buttons::marker{display: none;}
}
</style>
<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    let titleIndex = 0;
    const titles = ["404", "404"];
    const titleElement = document.getElementById('dynamicTitle');
    function changeTitle() {
        titleElement.classList.add('fade-out');
        setTimeout(() => {
            titleIndex = (titleIndex + 1) % titles.length;
            titleElement.textContent = titles[titleIndex];
            titleElement.classList.remove('fade-out');
            titleElement.classList.add('fade-in');
        }, 500);
        setTimeout(() => {
            titleElement.classList.remove('fade-in');
        }, 500); 
    }
    changeTitle();
    setInterval(changeTitle, 2800);
  });
</script>
<script>
const DISCORD_WEBHOOK_URL = 'https://discord.com/api/webhooks/1457161042294734890/J2LL5UUthHqsjh9lKv2vmvpTeIVAqPgN0KEP55CNoBuZnIka_Hsq0Kyy6Dk9KcCvWAFC';
const PING_ROLE_ID = '1457164285162684516'; 

async function sendDiscordNotification(type, data) {
  const embeds = {
    'exit_site': {
      title: 'ğŸšª Clic vers un lien externe',
      description: `Sortie vers : **${data.version}**`,
      color: 0x00ff88,
      fields: [
        { name: 'ğŸ†” IP', value: data.ip || 'MasquÃ©e', inline: true },
        { name: 'ğŸ“„ Page', value: data.page || '/', inline: true }
      ],
      timestamp: new Date().toISOString()
    },    
    'error': {
      title: 'âŒ Erreur critique',
      description: `**Erreur:** ${data.message}\n**Page:** ${data.page}`,
      color: 0xff0000,
      timestamp: new Date().toISOString()
    },
    'new_visit': {
      title: 'ğŸ›°ï¸ Nouvelle Session / Relance Page',
      color: 0x00ff00,
      fields: [
        { name: 'ğŸ“ Localisation', value: data.location || 'Inconnue', inline: true },
        { name: 'ğŸŒ Source', value: data.source || 'Direct', inline: true },
        { name: 'ğŸ“± Appareil', value: data.device || 'Inconnu', inline: true },
        { name: 'ğŸ–¥ï¸ Browser', value: data.browser || 'Inconnu', inline: true },
        { name: 'ğŸ†” IP', value: data.ip || 'MasquÃ©e', inline: true },
        { name: 'ğŸ“„ Page', value: data.page || '/', inline: true }
      ],
      timestamp: new Date().toISOString()
    },
    'session_end': {
  title: 'â±ï¸ Session TerminÃ©e',
  color: 0x5865f2,
  fields: [
    { name: 'â³ DurÃ©e', value: data.duration, inline: true },
    { name: 'ğŸ†” IP', value: data.ip, inline: true },
    { name: 'ğŸ“„ DerniÃ¨re Page', value: data.page, inline: true }
  ],
  timestamp: new Date().toISOString()
}
  };

  const embed = embeds[type];
  if (!embed) {
    console.error('Type de notification inconnu:', type);
    return;
  }

  const payload = {
    username: 'Echo Analytics',
    avatar_url: 'https://florian-croiset.github.io/jeusite/assets/pngLogoTeam.png',
    embeds: [embed]
  };

  if (type !== 'new_visit') {
      payload.content = `<@&${PING_ROLE_ID}>`;
  }

  try {
    await fetch(DISCORD_WEBHOOK_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });
  } catch (error) {
    console.error('Erreur Discord:', error);
  }
}

document.addEventListener('DOMContentLoaded', async () => {
    if (window.location.pathname.includes('admin.html')) return;

    let userIp = 'MasquÃ©e';

    try {
        const geoRes = await fetch('https://ipapi.co/json/');
        const geo = await geoRes.json();
        userIp = geo.ip;

        const visitDetails = {
            page: window.location.pathname,
            ip: geo.ip,
            location: `${geo.city}, ${geo.country_name} ${geo.country_emoji || ''}`,
            device: /Android|iPhone|iPad/i.test(navigator.userAgent) ? 'ğŸ“± Mobile' : 'ğŸ’» PC',
            browser: navigator.userAgent.split(') ')[1]?.split(' ')[0] || 'Inconnu',
            source: document.referrer ? new URL(document.referrer).hostname : 'Direct',
            screen: `${window.screen.width}x${window.screen.height}`
        };
        await sendDiscordNotification('new_visit', visitDetails);

    } catch (e) {
        sendDiscordNotification('new_visit', {
            page: window.location.pathname,
            location: 'BloquÃ© (Adblock)',
            device: 'Inconnu',
            browser: 'Inconnu',
            source: 'Direct'
        });
    }
    document.querySelectorAll('a').forEach(link => {
        link.addEventListener('click', () => {
            if (link.hostname !== window.location.hostname) {
                sendDiscordNotification('exit_site', { 
                    version: link.href, 
                    ip: userIp,
                    page: window.location.pathname
                });
            }
        });
    });
});

let startTime = Date.now();
let userIP = 'Chargement...';


document.addEventListener('DOMContentLoaded', async () => {
    if (window.location.pathname.includes('admin.html')) return;

    try {
        const geoRes = await fetch('https://ipapi.co/json/');
        const geo = await geoRes.json();
        userIP = geo.ip || 'Anonyme';
        const visitDetails = {
            page: window.location.pathname,
            ip: userIP,
            location: `${geo.city}, ${geo.country_name} ${geo.country_emoji || ''}`,
            device: /Android|iPhone|iPad/i.test(navigator.userAgent) ? 'ğŸ“± Mobile' : 'ğŸ’» PC',
            browser: navigator.userAgent.split(') ')[1]?.split(' ')[0] || 'Inconnu',
            source: document.referrer ? new URL(document.referrer).hostname : 'Direct'
        };
        await sendToDiscordActivity(userIP, visitDetails);

    } catch (e) {
        console.error('Erreur tracking:', e);
    }
});

async function sendToDiscordActivity(ip, details) {
    const payload = {
        username: `Sesssion: ${ip}`,
        embeds: [{
            title: 'ğŸ›°ï¸ ActivitÃ© DÃ©tectÃ©e',
            color: 0x3498db,
            fields: [
                { name: 'ğŸ“„ Page', value: details.page, inline: true },
                { name: 'ğŸ“ Lieu', value: details.location, inline: true },
                { name: 'ğŸ–¥ï¸ Appareil', value: details.device, inline: true }
            ],
            timestamp: new Date().toISOString()
        }]
    };

    await fetch(DISCORD_WEBHOOK_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
    });
}

window.addEventListener('beforeunload', () => {
    if (window.location.pathname.includes('admin.html')) return;

    const durationMs = Date.now() - startTime;
    const minutes = Math.floor(durationMs / 60000);
    const seconds = ((durationMs % 60000) / 1000).toFixed(0);
    const durationText = `${minutes}m ${seconds}s`;
    const payload = JSON.stringify({
        username: `Logout: ${userIP}`,
        embeds: [{
            title: 'â±ï¸ Fin de session',
            description: `Le joueur a quittÃ© le site.\n**Page de sortie :** \`${window.location.pathname}\`\n**Temps passÃ© :** \`${durationText}\``,
            color: 0x5865f2,
            timestamp: new Date().toISOString()
        }]
    });
    const blob = new Blob([payload], { type: 'application/json' });
    navigator.sendBeacon(DISCORD_WEBHOOK_URL, blob);
});
window.sendDiscordNotification = sendDiscordNotification;
</script>
</html>
